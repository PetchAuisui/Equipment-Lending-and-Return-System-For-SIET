{% extends 'base/blank.html' %}
{% block title %}‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/lost.css') }}">
{% endblock %}

{% block content %}
  <div class="lost-wrapper">

    <header class="lost-header">
      <i class="ri-file-edit-line"></i>
      <div class="lost-heading">‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢</div>
    </header>
    <form class="lost-card" method="post" enctype="multipart/form-data">

      <div class="row small">
        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á</label>
        <select name="report_type" class="input" required>
          <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
          <option value="lost">‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢</option>
          <option value="damaged">‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢</option>
        </select>
      </div>

      <div class="row">
        <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
        <input name="full_name" class="input" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
      </div>

      <div class="row">
        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
        <input name="phone" class="input" type="tel" placeholder="081-xxx-xxxx" required>
      </div>

      <div class="row">
        <label>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢/‡∏ä‡∏≥‡∏£‡∏∏‡∏î</label>
        <input name="device" class="input" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå" value="{{ equipment_name or '' }}" required>
      </div>

      <div class="two-col">
        <div class="row small">
          <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
          <input name="device_type" class="input" type="text" placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó" />
        </div>
        <div class="row small">
          <label>ID</label>
          <input name="device_id" class="input" type="text" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" value="{{ equipment_code or '' }}" />
        </div>
      </div>

      <div class="row">
        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢/‡∏ä‡∏≥‡∏£‡∏∏‡∏î</label>
        <div class="date-row">
          <input name="lost_day" class="input date" type="text" inputmode="numeric" maxlength="2" placeholder="DD" required>
          <span class="sep">/</span>
          <input name="lost_month" class="input date" type="text" inputmode="numeric" maxlength="2" placeholder="MM" required>
          <span class="sep">/</span>
          <input name="lost_year" class="input date" type="text" inputmode="numeric" maxlength="4" placeholder="YYYY" required>
          <span class="cal">üìÖ</span>
        </div>
      </div>

      <div class="row">
        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢/‡∏ä‡∏≥‡∏£‡∏∏‡∏î</label>
        <input name="place" class="input" type="text" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢" required>
      </div>

      <div class="row">
        <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤</label>
        <textarea name="detail" class="input textarea" rows="5" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
      </div>

      <div class="row">
        <label>‡∏£‡∏´‡∏±‡∏™‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (Rent ID)</label>
        <input name="rent_id" class="input" type="text" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° (‡πÄ‡∏ä‡πà‡∏ô 123)" value="{{ rent_id or '' }}" pattern="[0-9]*" title="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô">
      </div>

      <div class="row">
        <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</label>
        <input name="images" class="file" type="file" accept="image/*" multiple>
      </div>

      <div class="row actions">
        <div style="flex:1"></div>
        <div class="submit">
          <div class="error-message" id="errorMessage" role="alert" aria-live="assertive" style="display:none"></div>
          <button type="submit" class="btn-send" id="sendBtn">send</button>
        </div>
      </div>

    </form>
  </div>
{% endblock %}

{% block scripts %}
<script>
  (function(){
    const form = document.querySelector('.lost-card');
    const sendBtn = document.getElementById('sendBtn');
    const errorMessage = document.getElementById('errorMessage');

    // fields to validate
    const requiredSelectors = [
      '[name="report_type"]',
      '[name="full_name"]',
      '[name="phone"]',
      '[name="device"]',
      '[name="lost_day"]',
      '[name="lost_month"]',
      '[name="lost_year"]',
      '[name="place"]'
    ];

    function getFields(){
      return requiredSelectors.map(s=>document.querySelector(s));
    }

    function validate(){
      const fields = getFields();
      let valid = true;
      let firstInvalid = null;
      fields.forEach(f=>{
        if(!f) return;
        const v = (f.value || '').trim();
        if(!v){
          valid = false;
          f.classList.add('invalid');
          if(!firstInvalid) firstInvalid = f;
        } else {
          f.classList.remove('invalid');
        }
      });
      if(valid){
        errorMessage.style.display='none';
        sendBtn.disabled = false;
      } else {
        errorMessage.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°';
        errorMessage.style.display='block';
        sendBtn.disabled = true;
      }
      return {valid, firstInvalid};
    }

    // validate on input/change
    getFields().forEach(f=>{ if(f) f.addEventListener('input', validate); if(f) f.addEventListener('change', validate); });

    form.addEventListener('submit', function(e){
      const res = validate();
      if(!res.valid){
        e.preventDefault();
        if(res.firstInvalid) res.firstInvalid.focus();
      }
    });

    // initial check
    document.addEventListener('DOMContentLoaded', validate);
    // also run immediately in case DOMContentLoaded already fired
    validate();
  })();
</script>
{% endblock %}