<nav class="navbar">

  <!-- ‡πÅ‡∏ñ‡∏ß‡∏ö‡∏ô: Brand + ‡∏õ‡∏∏‡πà‡∏° user (‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π) -->
  <div class="navbar_login">

    <div class="nav-left">
      <a class="brand" href="{{ url_for('pages.home') }}">
        <img src="{{ url_for('static', filename='images/logo.png') }}"
             alt="SEIT Equipment"
             style="height: 45px; vertical-align: middle; object-fit: contain;">
      </a>
    </div>

    <div class="nav-right">

      {% if current_user.is_authenticated %}

        {% if session.get('role') in ['staff'] %}
          {% if request.path.startswith('/admin') %}
            <a href="{{ url_for('pages.home') }}" class="btn-nav btn-admin">Member</a>
          {% else %}
            <a href="{{ url_for('admin.admin_home') }}" class="btn-nav btn-admin">Admin</a>
          {% endif %}
        {% endif %}

        {# ===== ‚úÖ ‡∏õ‡∏∏‡πà‡∏° Instructor (‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏™) ===== #}
        {% set role  = session.get('role') %}
        {% set mtype = session.get('member_type') %}
        {% set empid = session.get('employee_id') %}

        {% if role in ['teacher','instructor'] or mtype == 'teacher' or empid %}
          {% if request.path.startswith('/instructor') %}
            <a href="{{ url_for('pages.home') }}" class="btn-nav btn-admin">Back</a>
          {% else %}
            <a href="{{ url_for('instructor.pending') }}" class="btn-nav btn-admin">Instructor</a>
          {% endif %}
        {% endif %}

        <a href="{{ url_for('auth.logout_action') }}" class="btn-nav btn-logout">Logout</a>

        <span class="user_identity">
          {{ current_user.email | replace('@kmitl.ac.th','') }}
          <i class="ri-user-line"></i>
        </span>

      {% else %}
        <div class="navbar_login_text">
          <a href="{{ url_for('auth.login_page') }}">Login</a>
          <span class="divider">|</span>
          <a href="{{ url_for('auth.register_page') }}">Sign in</a>
        </div>
      {% endif %}

    </div>
  </div>

  <!-- ‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏á (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß): ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å -->
  {% if not request.path.startswith('/admin') %}

  <div class="navbar_menu">
    <!-- ‡∏õ‡∏∏‡πà‡∏° hamburger -->
    <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18M3 12h18M3 18h18"
              stroke="white" stroke-width="2.4" stroke-linecap="round" fill="none"/>
      </svg>
    </button>

    <!-- ‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πâ‡∏≤‡∏¢ (drawer ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) -->
    <nav class="menu-panel" id="mainMenu">
      <a href="{{ url_for('pages.home') }}">Home</a>
      <a href="{{ url_for('inventory.lend_device') }}">Equipment</a>
      <a href="{{ url_for('tracking.track_index') }}">Track Status</a>
      <a href="{{ url_for('history.my_borrow_history') }}">History</a>
      <a href="{{ url_for('pages.policy') }}">Policy</a>
      <a href="{{ url_for('pages.about_us') }}">About Us</a>


      <!-- ‡πÄ‡∏°‡∏ô‡∏π Login / Logout -->
      {% if not current_user.is_authenticated %}
        <hr style="border:none;height:1px;background:rgba(255,255,255,.25);margin:6px 0;">
        <a href="{{ url_for('auth.login_page') }}">Login</a>
        <a href="{{ url_for('auth.register_page') }}">Sign in</a>
      {% else %}
        <hr style="border:none;height:1px;background:rgba(255,255,255,.25);margin:6px 0;">
        {% if session.get('role') in ['staff','admin'] %}
          {% if request.path.startswith('/admin') %}
            <a href="{{ url_for('pages.home') }}">Member</a>
          {% else %}
            <a href="{{ url_for('admin.admin_home') }}">Admin</a>
          {% endif %}
        {% endif %}
        <a href="{{ url_for('auth.logout_action') }}">Logout</a>
      {% endif %}
    </nav>


<div class="navbar_light position-relative">
  <!-- üîî ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏î‡∏¥‡πà‡∏á -->
  <button id="notifBell" class="btn-bell position-relative" aria-label="Notifications">
    <i class="ri-notification-4-line fs-5"></i>
    <span id="notifCount" 
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none"
          style="font-size: 0.65rem; min-width: 18px;">0</span>
  </button>

  <!-- üîΩ Dropdown ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
  <div id="notifDropdown"
       class="card shadow-lg position-absolute end-0 mt-2 rounded-4"
       style="width: 360px; display: none; z-index: 2000; background-color: #fff;">

    <div class="card-header bg-white border-0 fw-semibold text-dark">
      <i class="ri-error-warning-line me-1 text-danger"></i> ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    </div>

    <div id="notifList" class="p-3" style="max-height: 400px; overflow-y: auto;">
      <div class="text-center text-muted py-3 small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà</div>
    </div>
  </div>
</div>

<!-- ‚úÖ ‡πÇ‡∏´‡∏•‡∏î CSS/JS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/notifications.css') }}">
<script src="{{ url_for('static', filename='js/notifications.js') }}"></script>


  {% endif %}

</nav>

<script>
  (function(){
    const navbarMenu = document.querySelector('.navbar_menu');
    const toggleBtn  = navbarMenu?.querySelector('.menu-toggle');
    if(!toggleBtn) return;
    toggleBtn.addEventListener('click', function(){
      const isOpen = navbarMenu.classList.toggle('open');
      toggleBtn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    });
    // ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå
    navbarMenu.querySelectorAll('.menu-panel a').forEach(a=>{
      a.addEventListener('click', ()=> {
        navbarMenu.classList.remove('open');
        toggleBtn.setAttribute('aria-expanded','false');
      });
    });
  })();
</script>
