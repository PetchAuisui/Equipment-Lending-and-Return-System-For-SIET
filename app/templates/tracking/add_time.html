<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/trackstatus_add_time.css') }}">
  <title>ขยายเวลาการยืม</title>
</head>

{% extends 'base/base.html' %}
{% block title %}ขยายเวลาการยืม{% endblock %}
{% block content %}
<body>

<h1 class="page-title">ขยายเวลาการยืมอุปกรณ์</h1>

<div class="detail-container">
  <a href="{{ url_for('tracking.track_index') }}" class="btn-back">
    <i class="ri-arrow-left-line"></i> ย้อนกลับ
  </a>

  {% if rent %}
  <div class="card">
    {% if rent.image_path %}
      <img src="{{ url_for('static', filename=rent.image_path) }}" alt="{{ rent.equipment_name }}">
    {% endif %}

    <h2>{{ rent.equipment_name }} ({{ rent.equipment_code }})</h2>
    <div class="status">
      สถานะ: <span style="color: {{ rent.status_color }}">{{ rent.status_name }}</span>
    </div>

    <div class="date-row">
      <p><strong>วันที่ยืม:</strong> {{ rent.start_date.strftime('%d %B %Y') }}</p>
      <p><strong>วันที่กำหนดคืน:</strong> {{ rent.due_date.strftime('%d %B %Y') }}</p>
    </div>
  </div>

  <!-- ✅ ฟอร์มส่งข้อมูล -->
  <form action="{{ url_for('tracking.add_time_submit') }}" method="POST" class="extend-section">
    <input type="hidden" name="rent_id" value="{{ rent.rent_id }}">
    <input type="hidden" name="old_due" value="{{ rent.due_date.strftime('%Y-%m-%d') }}">
    <input type="hidden" name="created_at" value="{{ now().strftime('%Y-%m-%d %H:%M:%S') }}">

    <div class="input-block">
      <label for="extend_date"><strong>กำหนดคืนใหม่:</strong></label>
      <input type="date" id="extend_date" name="new_due" class="extend-input" required>
    </div>

    <div class="input-block">
      <label for="extend_reason"><strong>เหตุผลในการขยายเวลา:</strong></label>
      <textarea id="extend_reason" name="reason" rows="6" class="extend-textarea" placeholder="กรอกเหตุผลที่ต้องการขยายเวลาคืน..." required></textarea>
    </div>

    <div class="button-group">
      <a href="{{ url_for('tracking.track_index') }}" class="btn btn-cancel">ยกเลิก</a>
      <button type="submit" class="btn btn-submit">ยืนยันการขยายเวลา</button>
    </div>
  </form>

  {% else %}
    <p>ไม่พบข้อมูลการยืมนี้</p>
  {% endif %}
</div>

</body>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const extendInput = document.querySelector('input[name="new_due"]');
    const dueDate = "{{ rent.due_date.strftime('%Y-%m-%d') if rent and rent.due_date else '' }}";
    if (extendInput && dueDate) {
      extendInput.min = dueDate;
    }
  });
</script>
{% endblock %}
</html>
