{% extends 'base/base_admin.html' %}
{% block title %}‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå | ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå SIET{% endblock %}
{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_success_return.css') }}">

<div class="content-container">
    <div class="page-title">
        <i>‚ü≥</i>
        <span>‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</span>
    </div>

    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå / ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°..." onkeyup="filterTable()">
    </div>

    <table class="equipment-table" id="equipmentTable">
        <thead>
            <tr>
                <th>‡∏†‡∏≤‡∏û</th>
                <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡∏Ñ‡∏∑‡∏ô</th>
                <th>‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</th>
                <th class="center">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
        </thead>
        <tbody>
            {% for item in rent_list %}
                <tr>
                    <td>
                        {% if item.image %}
                            <img src="{{ url_for('static', filename=item.image) }}" class="img-thumb">
                        {% else %}
                            <img src="https://cdn-icons-png.flaticon.com/512/337/337940.png" class="img-thumb">
                        {% endif %}
                    </td>
                    <td>{{ item.equipment_code }}</td>
                    <td>{{ item.equipment_name }}</td>
                    <td>{{ item.return_date }}</td>
                    <td>{{ item.user_code }}</td>
                    <td>{{ item.user_name }}</td>
                    <td class="center">
                        <button class="btn btn-yellow">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                        <button class="btn btn-green" onclick="confirmReturn({{ item.rent_id }})">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô</button>
                        <button class="btn btn-red" onclick="reportLost({{ item.rent_id }})">‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢</button>
                    </td>
                </tr>
            {% endfor %}

            {% if rent_list|length == 0 %}
                <tr>
                    <td colspan="7" class="center">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Ñ‡∏∑‡∏ô</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<script>
    // üîç ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    function filterTable() {
        const input = document.getElementById("searchInput");
        const filter = input.value.toLowerCase();
        const table = document.getElementById("equipmentTable");
        const tr = table.getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {
            const rowText = tr[i].innerText.toLowerCase();
            tr[i].style.display = rowText.includes(filter) ? "" : "none";
        }
    }

    // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    async function confirmReturn(rentId) {
        if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç " + rentId + " ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
        try {
            const res = await fetch(`/api/return/${rentId}`, { method: 'POST' });
            const data = await res.json();
            alert(data.message);
            if (data.status === 'success') location.reload();
        } catch (err) {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
        }
    }

    // üö® ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢ (‡∏ï‡πà‡∏≠ API ‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ)
    async function reportLost(rentId) {
        alert("‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (rent_id: " + rentId + ")");
    }
</script>

{% endblock %}
