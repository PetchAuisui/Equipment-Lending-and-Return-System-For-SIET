{% extends 'base/base_admin.html' %}
{% block title %}‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå{% endblock %}
{% set CATEGORIES = ["IT & ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå","‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå/‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°","‡πÇ‡∏™‡∏ï‡∏ó‡∏±‡∏®‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤","‡∏Å‡∏µ‡∏¨‡∏≤","‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô "] %}

{# ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏ñ‡πâ‡∏≤ base ‡∏°‡∏µ block 'head' #}
{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_equipment_edit.css') }}?v=1">
{% endblock %}

{# ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏ñ‡πâ‡∏≤ base ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ 'extra_head' ‡πÅ‡∏ó‡∏ô #}
{% block extra_head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_equipment_edit.css') }}?v=1">
{% endblock %}

{% block content %}

{# ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3 (fallback): ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡πà‡∏≤‡∏ô @import ‡πÉ‡∏ô content ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ base ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡πÄ‡∏•‡∏¢ #}
<style>@import url("{{ url_for('static', filename='css/admin_equipment_edit.css') }}?v=1");</style>

<div class="eqedit-page">
  <div class="eqedit-container">
    <div class="eqedit-header">
      <h1 class="eqedit-header__title">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h1>
    </div>

    <div class="eqedit-card">
      <form action="{{ url_for('inventory.admin_equipment_edit', eid=item.equipment_id) }}"
            method="post" enctype="multipart/form-data">

        <div class="eqedit-row">
          <label class="eqedit-label">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
          <input class="eqedit-ctrl" type="text" name="name" value="{{ item.name or '' }}" required>
        </div>

        <div class="eqedit-row">
          <label class="eqedit-label">‡∏£‡∏´‡∏±‡∏™/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç *</label>
          <input class="eqedit-ctrl" type="text" name="code" value="{{ item.code or '' }}" required>
        </div>

        <div class="eqedit-row">
          <label class="eqedit-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
          <select class="eqedit-ctrl" name="category">
            <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‚Äî</option>
            {% for c in CATEGORIES %}
              <option value="{{ c }}" {% if item.category == c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="eqedit-row">
          <label class="eqedit-label">‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</label>
          <input class="eqedit-ctrl" type="text" name="brand" value="{{ item.brand or '' }}">
        </div>

        <div class="eqedit-row">
          <label class="eqedit-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
          <textarea class="eqedit-ctrl eqedit-ctrl--textarea" name="detail">{{ item.detail or '' }}</textarea>
        </div>

        <div class="eqedit-row">
          <label class="eqedit-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label>
          <input class="eqedit-ctrl" type="date" name="buy_date"
                 value="{{ item.buy_date.strftime('%Y-%m-%d') if item.buy_date else '' }}">
        </div>

        <div class="eqedit-row">
          <label class="eqedit-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select class="eqedit-ctrl" name="status">
            {% set s = item.status or '' %}
            <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‚Äî</option>
            <option value="available" {{ 'selected' if s=='available' else '' }}>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
            <option value="in_use"    {{ 'selected' if s=='in_use'    else '' }}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°</option>
            <option value="broken"    {{ 'selected' if s=='broken'    else '' }}>‡∏ä‡∏≥‡∏£‡∏∏‡∏î</option>
            <option value="lost"      {{ 'selected' if s=='lost'      else '' }}>‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢</option>
          </select>
        </div>

          <div class="row">
            <label style="font-weight:600;">‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</label>
            <div style="display:flex; gap:20px; margin-top:6px;">
              <label style="display:flex; align-items:center; gap:8px;">
                <input type="radio" name="require_teacher_approval" value="1">
                ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
              </label>

              <label style="display:flex; align-items:center; gap:8px;">
                <input type="radio" name="require_teacher_approval" value="0" checked>
                ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
              </label>
            </div>
          </div>

        {% if item.images and item.images|length > 0 %}
          {% set latest = (item.images|sort(attribute='created_at', reverse=True))|first %}
          <div class="eqedit-row">
            <label class="eqedit-label">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
            <div class="eqedit-preview">
              <img
                src="{{ url_for('static', filename=(latest.image_path|replace('\\','/'))) }}?v={{ (item.updated_at.timestamp() if item.updated_at else 0) }}"
                alt="‡∏£‡∏π‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô"
                class="eqedit-preview__img">
            </div>
          </div>
        {% endif %}

        <div class="eqedit-row">
          <label class="eqedit-label">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <input class="eqedit-ctrl" type="file" name="image" accept="image/*">
        </div>

        <div class="eqedit-actions">

          <button type="submit"
                  class="btn btn--danger"
                  formaction="{{ url_for('inventory.admin_equipment_delete', eid=item.equipment_id) }}"
                  formmethod="post"
                  formnovalidate
                  onclick="return confirm('‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?');">
            üóëÔ∏è ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ
          </button>

          <div class="eqedit-actions__right">

            <a class="btn" href="{{ url_for('inventory.admin_equipment_list') }}">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
            <button type="submit" class="btn btn--primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
