{% extends 'base/base_admin.html' %}
{% block title %}จัดการอุปกรณ์{% endblock %}

{% block content %}
<div style="padding: 24px; max-width: 1200px; margin: 0 auto; ">
  
  <!-- หัวข้อ + ค้นหา -->
  <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom: 20px;">
    <div style="display:flex; align-items:center; gap:12px;">
      <img src="{{ url_for('static', filename='images/icons/device.png') }}" style="width:48px; height:48px;">
      <h1 style="font-size:26px; font-weight:700;">จัดการอุปกรณ์</h1>
    </div>

    <form action="{{ url_for('inventory.admin_equipment_list') }}" 
          method="get" 
          style="width:320px;">
      <div style="display:flex; border:1px solid #ccc; border-radius:20px; overflow:hidden;">
        <input type="search" name="q" value="{{ request.args.get('q','') }}"
               placeholder=" ค้นหาอุปกรณ์ / หมายเลข"
               style="flex:1; padding:10px 14px; border:0; outline:0; font-size:15px;">
        <button style="padding:10px 16px; border:0; background:#f2f2f2; cursor:pointer;">ค้นหา</button>
      </div>
    </form>
  </div>

  <!-- กล่องหลัก: ทำให้เป็นตำแหน่งอ้างอิงเพื่อยึดปุ่มที่มุมล่างขวา -->
  <div style="
      position: relative;
      background:#f5f5f5;
      border-radius:12px;
      padding: 24px 24px 88px;   /* เผื่อพื้นที่ด้านล่างให้ปุ่ม */
      min-height: 360px;
    ">

    {% if items and items|length > 0 %}
      <!-- รายการการ์ด: ให้ responsive สมส่วน -->
      <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(420px, 1fr)); gap:20px;">
        {% for e in items %}
          <a href="{{ url_for('inventory.admin_equipment_detail', eid=e.equipment_id) }}"
            style="text-decoration:none; color:inherit;">
            <div style="background:white; border-radius:12px; padding:18px; display:flex; align-items:center; gap:20px;
                        box-shadow:0 2px 6px rgba(0,0,0,0.08); transition:.2s; cursor:pointer;"
                onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 4px 10px rgba(0,0,0,0.12)';"
                onmouseout="this.style.transform='none'; this.style.boxShadow='0 2px 6px rgba(0,0,0,0.08)';">
                
              <!-- รูปภาพ -->
                <div style="width:100px; height:100px; border-radius:50%; overflow:hidden; background:#e5e5e5;
                            display:flex; align-items:center; justify-content:center; flex:0 0 100px;">
                  {% if e.images and e.images|length > 0 %}
                      {% set latest = (e.equipment_images|sort(attribute='created_at', reverse=True))|first %}
                    <img src="{{ url_for('static', filename=(latest.image_path|replace('\\','/'))) }}?v={{ (e.updated_at.timestamp() if e.updated_at else 0) }}"
                        alt="ภาพอุปกรณ์"
                        style="display:block; width:100%; height:100%; object-fit:cover;">
                  {% else %}
                    <span style="color:#aaa; font-size:12px;">ไม่มีรูป</span>
                  {% endif %}
                </div>

              <!-- รายละเอียด -->
              <div style="flex:1; font-size:15px; line-height:1.8;">
                <div><strong>หมายเลข:</strong> {{ e.code or '—' }}</div>
                <div><strong>อุปกรณ์:</strong> {{ e.name or '—' }}</div>
                <div><strong>ยี่ห้อ:</strong> {{ e.brand or '—' }}</div>
                <div style="display:flex; align-items:center; gap:8px;">
                  <strong>สถานะ:</strong>
                  {% if e.status == "available" %}
                    <span style="background:#d4edda; color:#155724; padding:4px 12px; border-radius:20px; font-weight:600;">พร้อมใช้งาน</span>
                  {% elif e.status == "in_use" %}
                    <span style="background:#fff3cd; color:#856404; padding:4px 12px; border-radius:20px; font-weight:600;">กำลังใช้งาน</span>
                  {% elif e.status == "broken" %}
                    <span style="background:#f8d7da; color:#721c24; padding:4px 12px; border-radius:20px; font-weight:600;">ชำรุด</span>
                  {% elif e.status == "lost" %}
                    <span style="background:#e2e3e5; color:#383d41; padding:4px 12px; border-radius:20px; font-weight:600;">สูญหาย</span>
                  {% else %}
                    <span style="background:#e2e3e5; color:#383d41; padding:4px 12px; border-radius:20px; font-weight:600;">{{ e.status or '—' }}</span>
                  {% endif %}
              </div>
              </div>
            </div>
          </a>
        {% endfor %}
      </div>

    {% else %}
      <!-- ข้อความว่าง: จัดกลาง สัดส่วนสวย ไม่เบี้ยว -->
      <div style="height:220px; display:flex; align-items:center; justify-content:center; color:#777; font-size:17px;">
        — ยังไม่มีอุปกรณ์ในระบบ —
      </div>
    {% endif %}

    <!-- ปุ่มเพิ่มอุปกรณ์: ยึดมุมล่างขวาของกล่องเทาเสมอ -->
    <a href="{{ url_for('inventory.admin_equipment_new') }}"
       style="
          position:absolute; right:24px; bottom:24px;
          display:inline-flex; align-items:center; gap:8px;
          background:#4caf50; color:white; text-decoration:none;
          padding:12px 20px; font-size:16px; font-weight:600;
          border-radius:10px; box-shadow:0 3px 6px rgba(0,0,0,.15);
          transition:.2s;
       "
       onmouseover="this.style.background='#45a049'; this.style.transform='translateY(-2px)';"
       onmouseout="this.style.background='#4caf50'; this.style.transform='none';">
      ➕ เพิ่มอุปกรณ์
    </a>

  </div>
</div>
{% endblock %}
